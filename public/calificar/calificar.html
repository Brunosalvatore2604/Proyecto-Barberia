<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calificar servicio - Beauty Club</title>
    <link rel="stylesheet" href="/style.css">
    <style>
        body { background: #23232b; color: #fff; font-family: sans-serif; min-height: 100vh; margin:0; display:flex; flex-direction:column; align-items:center; justify-content:center; }
        .calificar-box { background: #2d2d38; border-radius: 16px; padding: 2em 2em 1.5em 2em; box-shadow: 0 2px 16px #0004; max-width: 350px; width: 100%; text-align: center; }
        .estrellas { display: flex; justify-content: center; gap: 0.3em; margin: 1em 0; }
        .estrella { font-size: 2.2em; cursor: pointer; color: #BBA3D0; transition: color 0.2s; }
        .estrella.selected, .estrella:hover, .estrella:hover ~ .estrella { color: #fff; }
        .btn { background: #BBA3D0; color: #23232b; border: none; border-radius: 8px; padding: 0.7em 1.5em; font-size: 1.1em; cursor: pointer; margin-top: 1em; }
        .msg { margin-top: 1em; font-size: 1.1em; }
    </style>
</head>
<body>
    <div class="calificar-box">
        <h2>¿Cómo fue tu experiencia?</h2>
        <div class="estrellas" id="estrellas">
            <span class="estrella" data-value="1">★</span>
            <span class="estrella" data-value="2">★</span>
            <span class="estrella" data-value="3">★</span>
            <span class="estrella" data-value="4">★</span>
            <span class="estrella" data-value="5">★</span>
        </div>
        <button class="btn" id="btn-enviar">Enviar calificación</button>
        <div class="msg" id="msg"></div>
    </div>
    <script>
    // Obtener token de la URL
    const token = window.location.pathname.split('/').pop();
    let puntuacion = 0;
    const estrellas = document.querySelectorAll('.estrella');
    estrellas.forEach(e => {
        e.addEventListener('mouseenter', function() {
            estrellas.forEach(st => st.classList.remove('selected'));
            for (let i = 0; i < +this.dataset.value; i++) estrellas[i].classList.add('selected');
        });
        e.addEventListener('mouseleave', function() {
            estrellas.forEach(st => st.classList.remove('selected'));
            if (puntuacion > 0) for (let i = 0; i < puntuacion; i++) estrellas[i].classList.add('selected');
        });
        e.addEventListener('click', function() {
            puntuacion = +this.dataset.value;
            estrellas.forEach(st => st.classList.remove('selected'));
            for (let i = 0; i < puntuacion; i++) estrellas[i].classList.add('selected');
        });
    });
    document.getElementById('btn-enviar').onclick = async function() {
        if (puntuacion < 1 || puntuacion > 5) {
            document.getElementById('msg').textContent = 'Selecciona una puntuación.';
            return;
        }
        this.disabled = true;
        document.getElementById('msg').textContent = 'Enviando...';
        const res = await fetch(`/api/calificar/${token}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ puntuacion })
        });
        const data = await res.json();
        if (data.ok) {
            document.getElementById('msg').textContent = '¡Gracias por tu calificación!';
            document.querySelector('.estrellas').style.pointerEvents = 'none';
        } else {
            document.getElementById('msg').textContent = data.mensaje || 'Error al guardar la calificación.';
            this.disabled = false;
        }
    };
    </script>
</body>
</html>
